## Python 프로젝트 실행 방법

프로젝트 루트에서 
```requirements.txt``` 생성

requirements.txt 내용:

```
langchain
langchain_core
langchain_google_genai
```

# 새 가상환경 생성
python -m venv .venv

# 가상환경 활성화 (Windows PowerShell)
.\.venv\Scripts\Activate.ps1

# 모듈 설치
pip install -r .\requirements.txt

--- 

## 출력파서 (OutputParser)란?

출력파서(OutputParser)는 LLM의 출력을 구조화하는 데 중요한 컴포넌트. LLM은 기본적으로 문자열을 반환한다. 
이러한 LLM의 출력을 받아 다양한 형식(JSON, 리스트, 딕셔너리 등)으로 변환해주는 것이 출력파서이다. LangChain은 다양한 종류의 출력파서를 제공한다. 

<PydanticOutputParser>
언어 모델의 출력을 더 구조화된 형태로 변환해주는 클래스. 단순 텍스트 형태가 아닌 문자열을 Pydantic 모델 (BaseModel)을 이용해 자동으로 파싱하고 스키마 유효성 검증을 제공하는 파서이다. 

즉, LLM이 "{"name": "홍길동", "age": 30}" 같은 JSON 문자열을 생성하면
→ Info(name="홍길동", age=30) 형태의 타입 안전한 Python 객체로 바꿔줍니다.

[설명]
```
class FootBallPlayerInfo(BaseModel):
    name: str = Field(description="이름")
    birthday: str = Field(description="생년월일")
    club: str = Field(description="소속 팀")
    nationality: str = Field(description="국적")
```

LLM이 만들어야 하는 출력 형태를 정의한 것. 즉, 모델에게 "출력은 반드시 이 4개의 정보로 구선된 JSON 형태여야 해"라고 알려주는 것. 
Pydantic의 BaseModel은 이 데이터 형식을 검증한다 (ex. birthday 데이터가 없는 경우 에러 냄)


```
prompt = PromptTemplate(
    template=(
        "다음 문장을 {format_instructions}에 맞는 JSON으로 변환해줘.\n"
        "{format_instructions}\n\n"
        "문장: {sentence}"
    ),
    input_variables=["sentence"],
    partial_variables={
        "format_instructions": parser.get_format_instructions()
    },
)
```

PromptTemplate에서 input_varibles는 실행 시점에 사용자가 넣을 값을 의미하고, partial_variables는 미리 고정시켜두는 값이다. 
위 코드에서 사용자가 나중에 넘겨줄 문장 sentence("부카요 사카는...")는 chain.invoke로 chain이 실행되는 시점에 값이 채워진다. 
반면에 LLM에게 출력 형식을 알려주는 문구인 format_instructions("JSON output should contain...")은 코드 실행 시점에 미리 값이 채워져있다. 

그래서 PromptTemplate이 완성되면 최종적으로는 이러한 문자열이 LLM에게 전달되고 sentence 값은 런타임에서 주입된다.

```
다음 문장을 JSON output should contain name, birthday, club, nationality 에 맞는 JSON으로 변환해줘.
JSON output should contain name, birthday, club, nationality

문장: 부카요 사카는 잉글랜드 프로 축구 선수로, 현재 잉글랜드 프리미어리그의 아스널 FC에서 활약하고 있으며, ...
``

LangChain의 get_format_instructions는 LLM이 따라야 하는 출력 규칙 설명서를 자동으로 만들어준다. 
특히 PydanticOutputParser는 내부적으로 영어 기반으로 작성된 포맷 지침 템플릿을 사용하기 때문에 실제로 parser.get_format_instructions()을 찍어보면 아래처럼 나온다:

```
The output should be a JSON object with the following keys:
- name: 이름
- birthday: 생년월일
- club: 소속 팀
- nationality: 국적
```


```
chain = prompt | llm | parser
```
'|' 는 LCEL 파이프라인 구조를 활용한 데이터 흐름 연결 연산자인다 (앞 단계의 결과를 다음 단계의 입력으로 전달).

우선 prompt가 입력 데이터를 받아서 LLM에게 보낼 프롬프트 문자열을 생성한다. 
llm은 이 프롬프트 문자열을 받아 Gemini에게 질의 후 응답을 생성한다. 
parser는 이 LLM의 문자열 결과를 받아 Pydantic 객체 구조로 변환한다. 

prompt가 LLM에게 보낼 문장을 완성 -> llm에서 Gemini가 문장을 분석하고 JSON으로 변환 -> praser는 JSON이 올바른지 확인 후 Pydantic 객체로 바꿔 줌.

